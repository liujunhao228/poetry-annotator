# 插件系统重构计划

## 1. 当前问题分析

通过分析代码，我们发现当前插件系统存在以下问题：

1. **插件依赖严重**：多种插件之间存在强依赖关系，几乎不能单独运作
2. **违反高内聚低耦合原则**：插件功能分散，职责不清晰
3. **适配器过多**：为了兼容旧系统，存在大量适配器类，增加了系统复杂性

## 2. 重构目标

1. **创建统一插件**：开发一个集成现有插件功能的统一插件
2. **减少插件间依赖**：通过重新设计接口和数据流，减少插件间的直接依赖
3. **提高内聚性**：将相关功能整合到统一插件中，提高模块内聚性
4. **降低耦合度**：通过标准接口和事件机制，降低插件间的耦合度

## 3. 重构方案

### 3.1 设计统一插件

我们将创建一个名为 `SocialPoemAnalysisPlugin` 的统一插件，集成以下功能：

1. **数据查询功能**：整合数据查询逻辑
2. **Prompt构建功能**：构建适用于社交情感分析的Prompt
3. **标签解析功能**：解析和扩展社交情感标签分类
4. **数据库初始化功能**：初始化社交诗分析相关的数据库

### 3.2 重构步骤

1. **分析现有插件功能**：
   - 详细分析 `SocialAnalysisPromptBuilderPlugin`、`HardcodedSocialEmotionCategoriesPlugin`、`SocialPoemAnalysisDBInitializer` 等插件的具体实现
   - 识别这些插件间的依赖关系

2. **设计统一插件接口**：
   - 创建新的插件类 `SocialPoemAnalysisPlugin` 实现所有必要的插件接口
   - 确保该插件可以独立运作，不依赖其他插件

3. **实现统一插件**：
   - 将现有插件的核心功能迁移到统一插件中
   - 移除不必要的适配器层
   - 优化数据流和控制流

4. **更新配置文件**：
   - 修改 `project/plugins.ini`，使用新的统一插件替换现有插件
   - 简化插件配置

5. **测试验证**：
   - 确保重构后的插件功能与之前一致
   - 验证插件可以独立运作
   - 测试整个标注流程

6. **文档更新**：
   - 更新相关文档，反映新的插件架构

## 4. 实施细节

### 4.1 统一插件设计

我们将创建 `SocialPoemAnalysisPlugin` 类，它将实现以下接口：
- `QueryPlugin`：用于数据查询
- `PromptBuilderPlugin`：用于Prompt构建
- `LabelParserPlugin`：用于标签解析
- `DatabaseInitPlugin`：用于数据库初始化

### 4.2 减少依赖关系

通过以下方式减少插件间的依赖：
1. 使用依赖注入模式，将依赖项通过构造函数传入
2. 使用事件驱动架构，插件间通过事件进行通信
3. 定义清晰的数据接口，避免直接访问其他插件的内部状态

### 4.3 提高内聚性

将相关的功能整合到统一插件中：
1. 将社交情感分析相关的数据查询、Prompt构建、标签解析等功能集中管理
2. 确保每个方法都专注于完成特定的任务

### 4.4 降低耦合度

通过以下方式降低耦合度：
1. 使用抽象接口而非具体实现
2. 通过配置文件管理插件行为，而非硬编码
3. 使用标准的数据结构进行插件间通信

## 5. 预期效果

1. **功能集成**：统一插件将原本分散在多个插件中的功能集中管理，便于维护和扩展
2. **降低复杂性**：减少了插件数量和配置项，降低了系统复杂性
3. **提高可维护性**：功能集中在一个插件中，便于定位问题和进行功能修改
4. **减少依赖关系**：插件之间不再存在强依赖关系，每个插件都可以独立运作